# themis-chains-contract
Themis main contracts. Original contract is written in solidity under smartsolidity directory.
smartjava is java code compiled with web3j tools.

### Setup/Ganache-cli Test ###

themis-chains-contract integrates with [Truffle](https://github.com/trufflesuite/truffle), [Ganache-cli](https://github.com/trufflesuite/ganache-cli),

[zeppelin-solidity](https://github.com/OpenZeppelin/zeppelin-solidity),
an Ethereum development environment, Ethereum test tools and Ethereum smart contract library.
Please install Truffle, Ganache-cli and zeppelin-solidity before start
```bash
npm install -g truffle
npm install -g ganache-cli
```

```bash
cd  themis-chains-contract/smartsolidity

npm install  // install dependencies
npm install -E zeppelin-solidity
```

`Note that OpenZeppelin does not currently follow semantic versioning.`
 you can fix import problem by ```npm install``` or 
 [testing-in-es6](http://jamesknelson.com/testing-in-es6-with-mocha-and-babel-6/).  
 
start ganache-cli
```bash
ganache-cli
```   
on another terminal, start test. you can config truffle.js to test on private chains.
```bash
cd themis-chains-contract/smartsolidity

truffle test
```

test result:
```bash
  Contract: Trade test
    ✓ should right create order by themis user (91ms)
    ✓ can not create two order with same orderID
    ✓ only themis user can create order
    ✓ trader can not confirm a order created by himself
    ✓ another themis user can confirm order, and should return actual hosters(even) (130ms)
    ✓ only buyer/seller can upload encrypted shard (331ms)
    ✓ upload secret will be revert when secret's length is not same with hoster's length
    ✓ buyer/seller can request for arbitration (45ms)
    ✓ only judge can judge the order (115ms)

  Contract: Hoster test
    Normal function test
      ✓ should right add/update/remove normal user (118ms)
    Hoster function test
      ✓ should right add hoster (167ms)
      ✓ should right update normal user to hoster (163ms)
      ✓ should right remove hoster and get back deposit (423ms)
    Get hoster service Test
      ✓ should right get hoster sort by fame and depoist (346ms)
      ✓ should right update one's fame/deposit, list position will be changed when he/she is a hoster (144ms)
      ✓ should right increase hoster' deposit, hoster's position will be changed (425ms)
      ✓ should right decrease hoster's deposit, hoster's position will be changed (541ms)
```


### Java Interface ###

Compiled java contract code is on generated by [web3j cmd tools](https://github.com/web3j/web3j/releases/tag/v3.4.0) and 
will used to communicate with ethereum nodes.

### Disclaim

The code is under rapid development and may change frequently.



