# themis-chains-contract
Themis main contracts. Original contract is written in solidity under smartsolidity directory.
smartjava is java code compiled with web3j tools.

### Setup/Ganache-cli Test ###

themis-chains-contract integrates with [Truffle](https://github.com/trufflesuite/truffle), [Ganache-cli](https://github.com/trufflesuite/ganache-cli),

[zeppelin-solidity](https://github.com/OpenZeppelin/zeppelin-solidity),
an Ethereum development environment, Ethereum test tools and Ethereum smart contract library.
Please install Truffle, Ganache-cli and zeppelin-solidity before start
```bash
npm install -g truffle
npm install -g ganache-cli
```

```bash
cd  themis-chains-contract/smartsolidity

npm install  // install dependencies
npm install -E zeppelin-solidity
```

`Note that OpenZeppelin does not currently follow semantic versioning.`
 you can fix import problem by ```npm install``` or 
 [testing-in-es6](http://jamesknelson.com/testing-in-es6-with-mocha-and-babel-6/).  
 
start ganache-cli
```bash
ganache-cli
```   
on another terminal, start test. you can config truffle.js to test on private chains.
```bash
cd themis-chains-contract/smartsolidity

truffle test
```

test result:
```bash
  Contract: Hoster test
    Normal function test
      ✓ should right add/update/remove normal user (98ms)
    Hoster function test
      ✓ should right add hoster (57ms)
      ✓ should right update normal user to hoster (160ms)
      ✓ should right remove hoster and get back deposit (320ms)
    Get hoster service Test
      ✓ should right get hoster sort by fame and depoist (236ms)
      ✓ should right update one's fame/deposit, list position will be changed when he/she is a hoster (85ms)
      ✓ should right increase hoster' deposit, hoster's position will be changed (310ms)
      ✓ should right decrease hoster's deposit, hoster's position will be changed (305ms)

  Contract: Trade test
    ✓ should right create order and pay fee(GET) for it (372ms)
    ✓ should return actual hosters(even) when number given by buyer is bigger than number of hosters (88ms)
    ✓ can not create two order with same orderID
    ✓ only buyer/seller can upload encrypted shard(mean request artibaion service) (899ms)
    ✓ hoster can upload buyer/seller's decrypted shard means another wins conflict (139ms)
    ✓ should revert if hoster want to upload both seller and buyer's decryptedShard (54ms)
```


### Java Interface ###

Compiled java contract code is on generated by [web3j cmd tools](https://github.com/web3j/web3j/releases/tag/v3.4.0) and 
will used to communicate with ethereum nodes.

### Disclaim

The code is under rapid development and may change frequently.



